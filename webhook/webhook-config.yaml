# caBundle este certificatul CA codificat in base64 care a semnat certificatul serverului folosit de webhook
# Acesta permite Kubernetes sa verifice identitatea webhook-ului atunci cand comunica cu el
# l-am obtinut din pasul de creare a cheilor si certificatelor din create-keys.sh
# folosind comanda: cat ca.crt | base64 | tr -d '\n'



#Aici sunt regulile si configuratia pentru webhook-ul nostru
# Acesta va intercepta cererile de creare a Pod-urilor si va aplica modificarile definite in serverul nostru webhook
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: hybrid-orchestrator-webhook
webhooks:
  - name: orchestrator.tcc.local
    admissionReviewVersions: ["v1"]
    sideEffects: None
    timeoutSeconds: 5
    rules:
      - operations: ["CREATE"]
        apiGroups: [""]
        apiVersions: ["v1"]
        resources: ["pods"]
    clientConfig:
      caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURIekNDQWdlZ0F3SUJBZ0lVQ1NKSE5rdDI2SWdHWFlKTlUzWktuRnByd0Qwd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0h6RWRNQnNHQTFVRUF3d1VTSGxpY21sa1QzSmphR1Z6ZEhKaGRHOXlRMEV3SGhjTk1qVXhNak14TURnegpOalF3V2hjTk1qWXhNak14TURnek5qUXdXakFmTVIwd0d3WURWUVFEREJSSWVXSnlhV1JQY21Ob1pYTjBjbUYwCmIzSkRRVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPc3V1bS9qVHE1eTJmOVEKUElzN2Z0V2FqYlRsSFgyckpEVndrYTFFWWQzMEFjN3Q1bzd6Q0laODB1K1JSSVpBU3ZmTHF6YnpUQnM1SnUwYQp5MGp1cnFYK1pkZVBJVmxrRXB1V2xnbks5TnNCeW5GTnJmWEszWW1qcm5SMXQ4WnBBV1k1VFlWNGZyMU54MUhhCmJ4WDNXRnM2OTdvTDBRUHl2c2w1Q1ZVQVVPT0pBemZ4YjVncGRXVW9CcWlGbW9DOW1rZFQvQVhPb1BzdUZXci8Kc3BTaFEwbTY5bXp4UU9WUEtDczVnSE1RU00veFpabDh3ZXFHOEdxeG8rZitIdWo0N2srb1AzMzh2Skp4SEJ2bwpDUWlVM1R5U1lQOThDTGtrTTBGUURMc0RDUlk4MzFjdytUazhNYlhnKzBrdkJqSm1OSStKRzI0WVJTZHN3UWpFCkdtVERoTEVDQXdFQUFhTlRNRkV3SFFZRFZSME9CQllFRkZ1N3ZvK204VmFROHVJeW5zM0VYai9VU2M1ZE1COEcKQTFVZEl3UVlNQmFBRkZ1N3ZvK204VmFROHVJeW5zM0VYai9VU2M1ZE1BOEdBMVVkRXdFQi93UUZNQU1CQWY4dwpEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSlZNTVV2bzFhRk5GVUFPS01hRkpIL29hMjF4ZUljT3VocGprd05LCkI1bHJDTmY3bnIyRTRLaHlpUVM3NWt1QlRlU1czZm5jalBGRXJ5MHpaenh0UnM3RUhYZ3FINVk0a2hMdll5dG8KR2VOaUhTMmc5NDhWbWRUcXEwaDdwaVdFMDhQM2llTG8wbUdXYjNMYndJV1hqUzZRTXdNZXRpc2VlOTlpcDd3RAorVys3NytOYUdjTzVwbU5IcG1Ha2F3WmY2eTBzWGhlOFlCK3Fnek83eXhoSzlld1VHSmZDamdMbDZiajEwekQ0CmNpSXVoRHFoWTJ5MFg1U2JoSTNySFJPN2tIK2Z4MTlPcTNvUHhaNzVLeUlOMGVBbHZlaEIvMVlBaytvMVdIYm8KQll5RXAxSi9tWmc1OFhCWWZZWlJmUDVuaDhpcjV0eEx1MG1qNXMyWGFDNmFrYmc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K" # Pune aici rezultatul de la cat ca.crt | base64
      service:
        name: hybrid-webhook-service  # Numele sub care va fi cunoscut serverul tÄƒu Go
        namespace: default             # Namespace-ul unde vei face deploy la serverul Go
        path: "/mutate"